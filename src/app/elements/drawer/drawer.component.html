<nz-drawer
  nzPlacement="right"
  nzWidth="600px"
  [nzClosable]="false"
  [nzVisible]="visible()"
  (nzOnClose)="close()"
  nzWrapClassName="elements-drawer-wrapper"
>
  <ng-container *nzDrawerContent>
    <nz-tabset (nzSelectChange)="onTabChange($event)">
      <nz-tab nzTitle="设置">
        <form nz-form nzLayout="vertical" class="setting-form">
          <nz-form-item>
            <nz-form-label>主题</nz-form-label>
            <nz-form-control>
              <nz-select
                [ngModelOptions]="{ standalone: true }"
                [(ngModel)]="setting.command_line.terminal_theme_name"
                (ngModelChange)="onThemeChange($event)"
                nzDropdownClassName="elements-drawer-dropdown"
              >
                @for (theme of terminalThemeMap; track theme.value) {
                  <nz-option [nzValue]="theme.value" [nzLabel]="theme.label"></nz-option>
                }
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </form>
      </nz-tab>
      <nz-tab nzTitle="文件管理">
        @if (hasConnected) {
          <iframe
            [src]="iframeURL | safeUrl"
            frameborder="0"
            style="width: 100%; height: 100%"
          ></iframe>
        } @else {
          <nz-empty nzNotFoundImage="simple" nzNotFoundContent="请先连接到资产"></nz-empty>
        }
      </nz-tab>
      <nz-tab nzTitle="会话分享">
        <!-- [disabled]="!hasConnected" -->
        <button nz-button nzType="primary" class="share-button" (click)="onCreateShareLink()">
          <nz-icon nzType="usergroup-add" nzTheme="outline" />
          创建分享链接
        </button>

        <nz-divider nzDashed [nzText]="text" nzOrientation="left">
          <ng-template #text>
            <nz-icon nzType="user" nzTheme="outline" />
            会话分享用户列表
          </ng-template>
        </nz-divider>

        <nz-list class="demo-loadmore-list" nzSize="small" [nzLoading]="initLoading">
          @for (item of list; track item) {
            <nz-list-item>
              @if (item.loading) {
                <nz-skeleton
                  [nzAvatar]="true"
                  [nzActive]="true"
                  [nzTitle]="false"
                  [nzLoading]="true"
                />
              } @else {
                <ng-container>
                  <nz-list-item-meta
                    nzAvatar="https://zos.alipayobjects.com/rmsportal/ODTLcjxAfvqbxHnVXCYX.png"
                    nzDescription="Ant Design"
                  >
                    <nz-list-item-meta-title>
                      {{ item.name.last }}
                    </nz-list-item-meta-title>
                  </nz-list-item-meta>

                  <ul nz-list-item-actions>
                    <nz-list-item-action>remove</nz-list-item-action>
                  </ul>
                </ng-container>
              }
            </nz-list-item>
          }
        </nz-list>
      </nz-tab>
    </nz-tabset>
  </ng-container>
</nz-drawer>

<nz-modal
  nzCentered
  [(nzVisible)]="showCreateShareLinkModal"
  [nzTitle]="modalTitle"
  [nzContent]="modalContent"
  [nzFooter]="modalFooter"
  (nzOnCancel)="handleCancel()"
  nzWrapClassName="create-share-link-modal"
>
  <ng-template #modalTitle>创建分享链接</ng-template>

  <ng-template #modalContent>
    <form nz-form nzLayout="vertical" [formGroup]="shareLinkForm">
      <nz-form-item>
        <nz-form-label>{{ 'ExpiredTime' | translate }}</nz-form-label>
        <nz-form-control>
          <nz-select formControlName="expired_time" nzPlaceHolder="请选择过期时间">
            @for (option of shareExpiredOptions; track option.value) {
              <nz-option [nzValue]="option.value" [nzLabel]="option.label"></nz-option>
            }
          </nz-select>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label>权限设置</nz-form-label>
        <nz-form-control>
          <nz-select formControlName="action_perm" nzPlaceHolder="请选择权限类型">
            @for (permission of shareUserPermissions; track permission.value) {
              <nz-option [nzValue]="permission.value" [nzLabel]="permission.label"></nz-option>
            }
          </nz-select>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label>分享用户</nz-form-label>
        <nz-form-control>
          <nz-select
            nzShowSearch
            nzAllowClear
            nzServerSearch
            nzMode="multiple"
            formControlName="users"
            nzPlaceHolder="请输入用户名"
            (nzOnSearch)="debounceSearch($event)"
          >
            @if (!loading) {
              @for (o of searchedUserList; track o) {
                <nz-option [nzValue]="o" [nzLabel]="o.username"></nz-option>
              }
            } @else {
              <nz-option nzDisabled nzCustomContent>
                <nz-icon nzType="loading" class="loading-icon" />
                Loading Data...
              </nz-option>
            }
          </nz-select>
        </nz-form-control>
      </nz-form-item>
    </form>
  </ng-template>

  <ng-template #modalFooter>
    <button nz-button nzType="default" (click)="handleCancel()">取消</button>
    <button nz-button nzType="primary" (click)="handleOk()" [nzLoading]="false">确认创建</button>
  </ng-template>
</nz-modal>
